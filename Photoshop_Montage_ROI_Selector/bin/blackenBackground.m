function [ ] = blackenBackground( )
% function [ ] = blackenBackground( )
% Robert Cooper 05-23-2013
%
%     Copyright (C) 2014  Robert F Cooper
% 
%     This program is free software: you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation, either version 3 of the License, or
%     (at your option) any later version.
% 
%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.
% 
%     You should have received a copy of the GNU General Public License
%     along with this program.  If not, see <http://www.gnu.org/licenses/>.
%
% Requires: Photoshop CS5 Extended, and an active connection to a running
% version of photoshop. Photoshop must be running before MATLAB starts!
%
%   This function turns the background (last layer) of any photoshop image
%   completely black.

blacken = ['var layers = app.activeDocument.artLayers;'...
'var len = layers.length;'...
'var background = layers[len-1];'...
''...
'app.activeDocument.activeLayer = background;'...
''...
'var idRset = charIDToTypeID( "Rset" );'...
'    var desc63 = new ActionDescriptor();'...
'    var idnull = charIDToTypeID( "null" );'...
'        var ref47 = new ActionReference();'...
'        var idClr = charIDToTypeID( "Clr " );'...
'        var idClrs = charIDToTypeID( "Clrs" );'...
'        ref47.putProperty( idClr, idClrs );'...
'    desc63.putReference( idnull, ref47 );'...
'executeAction( idRset, desc63, DialogModes.NO );'...
''...
'var idslct = charIDToTypeID( "slct" );'...
'    var desc84 = new ActionDescriptor();'...
'    var idnull = charIDToTypeID( "null" );'...
'        var ref60 = new ActionReference();'...
'        var idbucketTool = stringIDToTypeID( "bucketTool" );'...
'        ref60.putClass( idbucketTool );'...
'    desc84.putReference( idnull, ref60 );'...
'    var iddontRecord = stringIDToTypeID( "dontRecord" );'...
'    desc84.putBoolean( iddontRecord, true );'...
'    var idforceNotify = stringIDToTypeID( "forceNotify" );'...
'    desc84.putBoolean( idforceNotify, true );'...
'executeAction( idslct, desc84, DialogModes.NO );'...
''...
'var idFl = charIDToTypeID( "Fl  " );'...
'    var desc64 = new ActionDescriptor();'...
'    var idFrom = charIDToTypeID( "From" );'...
'        var desc65 = new ActionDescriptor();'...
'        var idHrzn = charIDToTypeID( "Hrzn" );'...
'        var idRlt = charIDToTypeID( "#Rlt" );'...
'        desc65.putUnitDouble( idHrzn, idRlt, 100 );'...
'        var idVrtc = charIDToTypeID( "Vrtc" );'...
'        var idRlt = charIDToTypeID( "#Rlt" );'...
'        desc65.putUnitDouble( idVrtc, idRlt, 100 );'...
'    var idPnt = charIDToTypeID( "Pnt " );'...
'    desc64.putObject( idFrom, idPnt, desc65 );'...
'    var idTlrn = charIDToTypeID( "Tlrn" );'...
'    desc64.putInteger( idTlrn, 0 );'...
'    var idAntA = charIDToTypeID( "AntA" );'...
'    desc64.putBoolean( idAntA, true );'...
'    var idUsng = charIDToTypeID( "Usng" );'...
'    var idFlCn = charIDToTypeID( "FlCn" );'...
'    var idFrgC = charIDToTypeID( "FrgC" );'...
'    desc64.putEnumerated( idUsng, idFlCn, idFrgC );'...
'    var idCntg = charIDToTypeID( "Cntg" );'...
'    desc64.putBoolean( idCntg, false );'...
'executeAction( idFl, desc64, DialogModes.NO );' ]; 

psjavascript(blacken);

end

